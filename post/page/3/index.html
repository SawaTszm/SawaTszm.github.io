<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | sawa.md</title>
<meta name=keywords content><meta name=description content="Posts - sawa.md"><meta name=author content><link rel=canonical href=https://SawaTszm.github.io/post/><link crossorigin=anonymous href=/assets/css/stylesheet.ef2f1bcbeb2a3515e049d97b5c2f36d516f1df5a2bad959bdde73fb8c7130782.css integrity="sha256-7y8by+sqNRXgSdl7XC821Rbx31orrZWb3ec/uMcTB4I=" rel="preload stylesheet" as=style><link rel=icon href=https://SawaTszm.github.io/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://SawaTszm.github.io/images/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://SawaTszm.github.io/images/favicon.ico><link rel=apple-touch-icon href=https://SawaTszm.github.io/images/favicon.ico><link rel=mask-icon href=https://SawaTszm.github.io/images/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://SawaTszm.github.io/post/index.xml><link rel=alternate hreflang=ja href=https://SawaTszm.github.io/post/><link rel=alternate hreflang=en href=https://SawaTszm.github.io/en/post/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-188317733-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Posts"><meta property="og:description" content="猫と爬虫類とゲームが好き"><meta property="og:type" content="website"><meta property="og:url" content="https://SawaTszm.github.io/post/"><meta property="og:image" content="https://SawaTszm.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="sawa.md"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://SawaTszm.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Posts"><meta name=twitter:description content="猫と爬虫類とゲームが好き"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://SawaTszm.github.io/post/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://SawaTszm.github.io/ accesskey=h title="sawa.md (Alt + H)"><img src=https://SawaTszm.github.io/images/avatar.png alt aria-label=logo height=35>sawa.md</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://SawaTszm.github.io/en/ title=En aria-label=En>En</a></li></ul></div></div><ul id=menu><li><a href=https://SawaTszm.github.io/page/about/ title=About><span>About</span></a></li><li><a href=https://SawaTszm.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://SawaTszm.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://SawaTszm.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://SawaTszm.github.io/>ホーム</a></div><h1>Posts
<a href=index.xml title=RSS aria-label=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class=post-entry><header class=entry-header><h2>【AWS SAM】テンプレートでCloudWatchイベントを記述する</h2></header><div class=entry-content><p>目的 バッチ処理もAWS Lambdaで書きたいので、SAM テンプレートに記述できるのかどうかを調べたい。
結論 できます。
し、かなりわかりやすいです。
CloudWatch イベント アプリケーションの AWS SAM テンプレート
記述例 AWSTemplateFormatVersion: "2010-09-09" Transform: AWS::Serverless-2016-10-31 Globals: Function: Timeout: 30 MemorySize: 256 Handler: app.lambda_handler Runtime: python3.7 Resources: ### Batch ### HogeBatchFunction: Type: AWS::Serverless::Function Properties: CodeUri: api/batch/hoge_batch Events: HogeBatch: # TypeをScheduleに Type: Schedule Properties: # 実行タイミングを決める Schedule: cron(0 0 ? * SUN *) 最後のSchedule式は、rateとcronのどちらでも使えます。
Rate または Cron を使用したスケジュール式
参考 ざっと見て参考にさせてもらいたいなと思った記事(と公式ドキュメント):
What Is the AWS Serverless Application Model (AWS SAM)?...</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【AWS SAM】テンプレートでCloudWatchイベントを記述する" href=https://SawaTszm.github.io/post/aws-sam-template/></a></article><article class=post-entry><header class=entry-header><h2>【DDD】前提知識まとめ</h2></header><div class=entry-content><p>目的 社内お勉強会で DDD 本を輪読することになったんですが、
改めて「〇〇ってわかりますか？」と言われると戸惑ってしまうことが多いので自分用にまとめました。
抽象クラス(abstract class) 他のクラスで継承してもらうことを前提としたクラス。
複数のクラスの共通処理の中に、一部異なる処理を使用したい場合などに定義する。
抽象クラス自体はインスタンス化できない abstract functionで抽象メソッドを定義できる インターフェース クラスが実装するメソッドを定義することができるもの。
メソッドの実体は持てない(定義のみ) 使用できる修飾子はpublicのみ 定数を持てる。実装先のクラスでのオーバーライドはできない
不特定のクラスで、共通のメソッドを定義したい場合などに定義する。 ポリモーフィズム 「中に入るものによって、同じ関数でも違う処理を行える」というオブジェクト指向プログラミングの特徴のこと。
「モノが「そのモノ」らしく振る舞うこと」 =「呼び出した関数が、呼び出し元のオブジェクトに適した振る舞いをすること」
# 動物は必ず「鳴く」 interface Animal { sound(); } # 犬は「動物らしい振る舞い」をする(鳴く) class dog implements Animal { sound() { /**/ } } # 動物は「鳴く」ので、引数の動物ごとの異なる鳴き声を処理する # 引数で与えられる動物によって、異なる処理(鳴き声)ができる public function animalsound(animal) { animal.sound() } 継承 親クラスの振る舞いを引き継いで、子クラスを実装すること。 子クラス側で親クラスを拡張することができる。
委譲 実際の振る舞いを別のオブジェクトに委ねることで、別のオブジェクトの振る舞いを再利用する手法。(？)
カプセル化 関連のあるデータとその使い方を一まとめにしたもの。 内部のデータを直接いじることはさせずに、使い方だけを見せる。
GoF デザインパターン 23 種類あるヤツ(雑)
勉強します
3 分でわかるデザインパターン入門
SOLID 原則 SOLID 原則とは Robert C....</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【DDD】前提知識まとめ" href=https://SawaTszm.github.io/post/ddd-%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98%E3%81%BE%E3%81%A8%E3%82%81/></a></article><article class=post-entry><header class=entry-header><h2>【Docker】【nginx】docker-compose上のnginxをhttps対応する(開発環境編)</h2></header><div class=entry-content><p>目的 docker-composeで立てたnginxをhttps対応にしたい。
あくまでも開発環境用なのでオレオレ証明書です。
手順 自己署名証明書をサクッと作成する ❯ openssl req -x509 -nodes -new -keyout server.key -out server.crt -days 365 docker-composeの更新 443ポートを使用するように変更。
また、作成した証明書も読み込めるようにvolumesも更新。
version: "3.5" services: web: build: ./docker/nginx restart: always ports: - 443:443 # 変更 depends_on: - app volumes: - ./:/var/www/html - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf - ./docker/nginx/server.crt:/etc/nginx/server.crt # 追加 - ./docker/nginx/server.key:/etc/nginx/server.key # 追加 links: - app networks: - default default.confの更新 ポートを443に変更し、証明書の情報を追加します。
server { listen 443; ssl on; ssl_certificate /etc/nginx/server.crt; ssl_certificate_key /etc/nginx/server.key; index index.php index.html; server_name php-docker....</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【Docker】【nginx】docker-compose上のnginxをhttps対応する(開発環境編)" href=https://SawaTszm.github.io/post/docker-nginx-ssl-on-server/></a></article><article class=post-entry><header class=entry-header><h2>【Embulk】インストール＆dynamoDBのインポートを試してみる</h2></header><div class=entry-content><p>割と大量のデータを別の場所に転送したい。といった要件があり、諸々模索している最中で、先輩から教えてもらったEmbulkを触ってみたのでまとめました。
Embulkとは GitHub - embulk/embulk: Embulk: Pluggable Bulk Data Loader.
さまざまなストレージ、データベース、NoSQL、クラウドサービス間のデータ転送を支援する並列バルクデータローダーです。
関数を追加するプラグインをサポートしており、インプット先/アウトプット先に沿ったプラグインを適宜使用する/作成することで、前述の様々なストレージやDBなどでデータ転送を行うことができます。
インストール Brewでインストール可能です。
$ brew install embulk # embulk: Java 1.8 is required to install this formula. と言われたらエラー文通り下記でJava入れてもう一回 $ brew cask install homebrew/cask-versions/adoptopenjdk8 必要だなと思ったプラグインをプラグイン一覧から確認してインストール。
# CSVインポート $ embulk gem install embulk-input-jdbc # mysqlインポート $ embulk gem install embulk-input-mysql # mysqlアウトプット $ embulk gem install embulk-output-mysql # などなど チュートリアル 公式ドキュメントに乗っている、めちゃくちゃ簡単な動作確認チュートリアルです。
CSVを読み込んで画面に表示するだけの簡単なものになっています。
# サンプルCSVファイル、構成ファイルを作成 $ embulk example ./try1 # 推測プラグインを呼び出して適切な構成ファイル(提案)を出力。 $ embulk guess ....</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【Embulk】インストール＆dynamoDBのインポートを試してみる" href=https://SawaTszm.github.io/post/embulk-install-and-dynamodb-import/></a></article><article class=post-entry><header class=entry-header><h2>【laravel-admin】インストール＆画面作成まで 編</h2></header><div class=entry-content><p>目的 ここ最近、しばらくlaravel-adminという管理画面を作成するためのライブラリを使っていたので、調べたことやつまづいたところも含めて少しずつ書き起こそうと思います。
まずはインストール編です。簡単に管理画面を確認できるところまで見ていきましょう。
laravel-adminとは laravelで簡単にDBの管理画面を作成することができるライブラリです。
ドキュメントやデモサイトなど使用するために必要な資料が充実しており、難しいカスタムを行う必要がなければものすごく簡単に管理画面が構築できます。
Laravel-admin(ドキュメント)
GitHubページ
基本的な使用方法は上記でカバーし、カスタマイズして使用したい際には直接ソースコードを読んで適宜書き換えていく形になります。
主観ですが、コード内のコメントも(おそらく書き換える前提の部分は)丁寧に書かれているので、しっかり読み解けば問題ないかと思います。
プロジェクトの作成 既に開発しているlaravelプロジェクトに追加する場合は、この章は飛ばしてもらって大丈夫です。
何もないところからlaravel-adminを試したい方は、まずlaravelプロジェクトを作成するところから始めましょう。
公式によると、現在のバージョンでは以下の環境が推奨されるようです。
PHP 7+ laravel 5.5+ This package requires PHP 7+ and Laravel 5.5, for old versions please refer to 1.4
laravel-admin install
$composer create-project --prefer-dist "laravel/laravel=5.5.*" &lt;project-name> DBも必要になってくるので、.envにDBの情報も書き足しておきましょう。
よければこちらの記事も参考にしてみてください。
【Laravel+MySQL+nginx】docker-composeで最小構成の環境構築 - SawaLog
インストール laravelの準備ができたら早速laravel-adminをインストールします。
$composer require encore/laravel-admin インストールが終わったら下記コマンドを実行します。
$php artisan vendor:publish --provider="Encore\Admin\AdminServiceProvider" $php artisan admin:install これらを実行すると、app/Adminディレクトリが作られます。これからの実装はこのディレクトリ配下で行うことになります。
ファイルの初期配置は以下。
app/Admin ├── Controllers │ ├── ExampleController.php │ └── HomeController.php ├── bootstrap....</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【laravel-admin】インストール＆画面作成まで 編" href=https://SawaTszm.github.io/post/laravel-admin-install/></a></article><article class=post-entry><header class=entry-header><h2>【Laravel】Laravelで使用するDBををReadWrite構成にする時の確認でちょっとハマった話</h2></header><div class=entry-content><p>起こった問題 タイトルの通り、Laravelで使用するDBのhostをRead/Weiteで切り替えたい、と思って設定をしていました。
設定後下記を確認して、
>>> config('database.connections.pgsql') => [ "read" => [ "host" => [ "postgres2", ], ], "write" => [ "host" => "postgres", ], ... 反映されてるな、と思って念の為connectionも見てみました。
>>> DB::connection('pgsql::read')->getConfig(); => [ ..., "host" => "postgres", ] ……あれ？
Readコネクションなのでpostgres2であって欲しいのに、postgresが出てきてしまいました。
反映されてないのかな？と思い色々調べたので、備忘録として置いて起きます。
調べたこと getConfigで参照されるconfigは、
Illuminate\Database\Connectors\ConnectionFactory::make内で、
/** * Establish a PDO connection based on the configuration. * * @param array $config * @param string|null $name * @return \Illuminate\Database\Connection */ public function make(array $config, $name = null) { $config = $this->parseConfig($config, $name); if (isset($config['read'])) { return $this->createReadWriteConnection($config); } return $this->createSingleConnection($config); } createReadWriteConnectionが呼び出され、...</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【Laravel】Laravelで使用するDBををReadWrite構成にする時の確認でちょっとハマった話" href=https://SawaTszm.github.io/post/laravel%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8Bdb%E3%82%92%E3%82%92readwrite%E6%A7%8B%E6%88%90%E3%81%AB%E3%81%99%E3%82%8B%E6%99%82%E3%81%AB%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E8%A9%B1/></a></article><article class=post-entry><header class=entry-header><h2>【Laravel】フォームリクエストでのバリデーションに条件付きの制約を追加する</h2></header><div class=entry-content><p>やりたいこと Laravel くんで Controller をすっきりさせたいので、バリデーションをフォームリクエストで行いたい。
プラスで、簡単な条件分岐のバリデーションも付け足したい。
結論 withValodatorメソッドを通してsometimesを使うのが良さげです。
詳しく 通常のフォームリクエストでのバリデーション // FormRequest namespace App\Http\Request; use \\illuminate\Foundation\Http\FormRequest; class ItemUpdateRequest extends FormRequest { /** * Determine if the user is authorized to make this request. * * @return bool */ public function authorize() { return true; } public function rules() { return [ 'id' => 'required|integer', 'item_type' => 'required|string|in:tv,web,radio' 'name' => 'required|string|max:255', 'url' => 'nullable|url|max:2083, 'note' => 'nullable|string|max:2047', ]; } } // Controller(必要な記述以外は省略) use App\Http\Request\ItemUpdateRequest; class ItemController extends Controller { public function update(ItemUpdateRequest $request) { // } } これだけで通常のバリデーションは出来ますね。...</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【Laravel】フォームリクエストでのバリデーションに条件付きの制約を追加する" href=https://SawaTszm.github.io/post/laravel-%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%81%A7%E3%81%AE%E3%83%90%E3%83%AA%E3%83%87%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%81%AE%E5%88%B6%E7%B4%84%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B/></a></article><article class=post-entry><header class=entry-header><h2>【Laravel】独自ペジネータで自前のCollectionを使う</h2></header><div class=entry-content><p>やりたいこと データベース：ペジネーション 5.8 Laravel
このページの「独自ペジネータ作成」の欄にあるように、
Illuminate\Pagination\LengthAwarePaginatorインスタンスを作成して、自前の Collection を Collection のままページネーションしたい。
結論 ペジネーションは引数に Collection を許容しているので実装が可能。
LengthAwarePaginatorインスタンスの第一引数に渡す Collection を、slice()メソッドを使って Collection の型を崩さずに区切る。
これだけ見ると「自明では？」と思うけど、初心者(私)はどハマりしたので過程も含めて書いておきます。
ハマった流れ まず「Eloquent ORM から取ってきた結果をページネーションしたいわね」と思い Laravel くんドキュメント(前述)を参照しました。
Note: 自前でペジネーターインスタンスを生成する場合、ペジネーターに渡す結果の配列を自分で”slice”する必要があります。その方法を思いつかなければ、 [array_slice] PHP 関数を調べてください。
なるほど！！！！！
と思い array_slice()を使用して記述したのが以下のような書き方。
// app/Services/ItemsService.php // 前略。$columnsには取得したいカラム名を格納 $items = ItemMaster::query() ->select($columns) ->with('relatedUsers') ->get(); // 表示する件数のみ取得するために、ページ番号($page)と最大表示件数($limit)から$offsetを計算 $offset = ($page * $limit) - $limit; // ドキュメントに言われたように表示する部分のみ切り取った配列を用意 $slice = array_slice($items->toArray(), $offset, $limit); return new LengthAwarePaginator($slice, count($items), $limit, $page); これでも$columnsの値を参照する分には特に問題ありません。
ただ、return を受け取った先の Resource なんかでリレーションの情報が欲しくて$this->relatedUsers....</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【Laravel】独自ペジネータで自前のCollectionを使う" href=https://SawaTszm.github.io/post/laravel-%E7%8B%AC%E8%87%AA%E3%83%9A%E3%82%B8%E3%83%8D%E3%83%BC%E3%82%BF%E3%81%A7%E8%87%AA%E5%89%8D%E3%81%AEcollection%E3%82%92%E4%BD%BF%E3%81%86/></a></article><article class=post-entry><header class=entry-header><h2>【Laravel+MySQL+nginx】docker-composeで最小構成の環境構築</h2></header><div class=entry-content><p>目的 laravel-admin使いたいだけの用途にLaradockは重すぎる……
ので、お勉強も兼ねて、docker-composeでLaravel&amp;MySQLのみの環境を立てました。
その上でlaravel-adminの管理画面まで開けるようにしてみます。
構成 project_root_dir ├── docker-compose.yml ├── docker │ ├── nginx │ │ ├── Dockerfile │ │ └── default.conf │ ├── php │ │ └── Dockerfile │ └── db │ │ ├── my.cnf │ └── Dockerfile └── laravel └── ... 手順 docker-compose.ymlを作成 # docker-compose.yml version: "3.5" services: app: build: context: . dockerfile: ./docker/php/Dockerfile args: PROJECT_NAME: app_admin volumes: - ./:/var/www/html depends_on: - database links: - database ports: - "4000:80" - "4001:8080" tty: true database: image: mysql:5....</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【Laravel+MySQL+nginx】docker-composeで最小構成の環境構築" href=https://SawaTszm.github.io/post/laravel+mysql+nginx-docker-compose%E3%81%A7%E6%9C%80%E5%B0%8F%E6%A7%8B%E6%88%90%E3%81%AE%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89/></a></article><article class=post-entry><header class=entry-header><h2>【MySQL】外部キー追加時にエラー</h2></header><div class=entry-content><p>エラー 外部キー制約を追加しようとした時、下記エラーで怒られました。
ERROR 1215 (HY000): Cannot add foreign key constraint “外部キー制約を追加できません”
もっと詳細なエラーログが……ほしい……！ と思ったので調べました。
SHOW ENGINE INNODB STATUS で外部キー制約時のエラーを確認 恐らくとてつもなく初歩的な話だと思うのですが、SHOW ENGINE 構文なるものがあると。
SHOW ENGINE INNODB STATUS SHOW ENGINE INNODB STATUSは、InnoDBストレージエンジンの状態に関するInnoDB標準モニターからの広範囲にわたる情報を表示します。
MySQL :: MySQL 5.6 リファレンスマニュアル :: 13.7.5.16 SHOW ENGINE 構文
便利だ！！！！！
実践 早速入って見てみます。
$ docker exec -it [docker-name] bash # mysql -u [username] -p > SHOW ENGINE INNODB STATUS ------------------------ LATEST FOREIGN KEY ERROR ------------------------ Cannot find an index in the referenced table where the referenced columns appear as the first columns, or column types in the table and the referenced table do not match for constraint....</p></div><footer class=entry-footer>&lt;span title='2021-02-19 12:01:46 +0900 +0900'>2月 19, 2021&lt;/span></footer><a class=entry-link aria-label="post link to 【MySQL】外部キー追加時にエラー" href=https://SawaTszm.github.io/post/mysql-%E5%A4%96%E9%83%A8%E3%82%AD%E3%83%BC%E8%BF%BD%E5%8A%A0%E6%99%82%E3%81%AB%E3%82%A8%E3%83%A9%E3%83%BC/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://SawaTszm.github.io/post/page/2/>«&nbsp;前のページ&nbsp;
</a><a class=next href=https://SawaTszm.github.io/post/page/4/>次のページ&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=https://SawaTszm.github.io/>sawa.md</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>